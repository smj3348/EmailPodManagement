{% extends "base.html" %}
{% block title %}VPS Servers | Devices | Outbound Operations{% endblock %}

{% block content %}
<h2>VPS Servers (Devices)</h2>

<form method="get" class="filter-bar" style="margin-bottom: 1rem;">
    <input type="text"
           name="q"
           placeholder="Search by code, name, IP, hostname, domain..."
           value="{{ q }}"
           style="padding: 0.4rem 0.6rem; min-width: 260px;">

    <select name="provider" style="padding: 0.4rem 0.6rem; margin-left: 0.5rem;">
        <option value="">All providers</option>
        <option value="IONOS" {% if provider == "IONOS" %}selected{% endif %}>IONOS</option>
        <option value="OTHER" {% if provider == "OTHER" %}selected{% endif %}>Other</option>
    </select>

    <select name="active" style="padding: 0.4rem 0.6rem; margin-left: 0.5rem;">
        <option value="">All</option>
        <option value="true" {% if active == "true" %}selected{% endif %}>Active</option>
        <option value="false" {% if active == "false" %}selected{% endif %}>Inactive</option>
    </select>

    <select name="pod" style="padding: 0.4rem 0.6rem; margin-left: 0.5rem;">
        <option value="">All pods</option>
        {% for p in pods %}
            <option value="{{ p.slug }}" {% if pod == p.slug %}selected{% endif %}>{{ p.name }}</option>
        {% endfor %}
    </select>

    <button type="submit" style="padding: 0.4rem 0.9rem; margin-left: 0.5rem;">
        Filter
    </button>
</form>

{% if servers %}
    <div class="dash-grid">
        {% for s in servers %}
            <section class="dash-card">
                <h3>{{ s.code }} — {{ s.friendly_name }}</h3>
                <p>
                    {% if s.pod %}<strong>Pod:</strong> {{ s.pod.name }}<br>{% endif %}
                    <strong>Provider:</strong> {{ s.provider }}{% if s.package %} ({{ s.package }}){% endif %}<br>
                    {% if s.main_ip %}<strong>IP:</strong> {{ s.main_ip }}<br>{% endif %}
                    {% if s.hostname %}<strong>Hostname:</strong> {{ s.hostname }}<br>{% endif %}
                    {% if s.domain %}<strong>Domain:</strong> {{ s.domain }}<br>{% endif %}
                </p>
                <p>
                    {% if s.panel_url %}
                        <a href="{{ s.panel_url }}" target="_blank" rel="noopener noreferrer">Panel</a>
                    {% endif %}
                    {% if s.webmail_url %}
                        · <a href="{{ s.webmail_url }}" target="_blank" rel="noopener noreferrer">Webmail</a>
                    {% endif %}
                </p>
                <p>
                    <a href="{% url 'devices_vps_detail' slug=s.slug %}">View details →</a>
                </p>
            </section>
        {% endfor %}
    </div>
{% else %}
    <p>No VPS servers found.</p>
{% endif %}
{% endblock %}
